var priceFieldsValidKeyCodes=[8,9,27,35,36,37,38,39,40,46,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,110,116,144,188,190];var priceFieldsValidCtrlKeyCodes=[37,39,45,65,67,86,87,88];var priceFieldsSingleKeyCode=[110,188,190];var priceFieldsInvalidStartKeyCodes=priceFieldsSingleKeyCode
var priceFieldsNumberKeyCode=[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];function priceFieldsFunction(element){var thisEl=jQuery(element);thisEl.attr('maxlength','13');thisEl.keydown(function(event){var inputVal=thisEl.val();if(thisEl.text_is_selected&&in_array(event.keyCode,priceFieldsValidKeyCodes)){thisEl.text_is_selected=false;return true;}
if(event.altKey)return false;if(event.ctrlKey&&in_array(event.which,priceFieldsValidCtrlKeyCodes))return true;if(inputVal===''&&in_array(event.keyCode,priceFieldsInvalidStartKeyCodes))return false;if(!in_array(event.keyCode,priceFieldsValidKeyCodes))return false;if(in_array(event.keyCode,priceFieldsSingleKeyCode)&&(strpos(inputVal,',')!==false||strpos(inputVal,'.')!==false))return false;var sepPos=strpos(inputVal,'.');if(sepPos===false)sepPos=strpos(inputVal,',');if(sepPos!==false){inputVal=trim(inputVal);var afterSepVal=substr(inputVal,(sepPos+1));if(afterSepVal.length>=2&&in_array(event.keyCode,priceFieldsNumberKeyCode))return false;}else if(inputVal.length>=10&&in_array(event.keyCode,priceFieldsNumberKeyCode))return false;}).select(function(){thisEl.text_is_selected=true;}).blur(function(){var val=floatval(str_replace(',','.',trim(thisEl.val())));if(val>0)val=number_format(val,2,'.','')
else val='';thisEl.val(val);});if(thisEl.attr('with_default_price')==='true'){thisEl.addClass('price_field_mod');var defaultVal=thisEl.val();thisEl.focus(function(){if(thisEl.val()===defaultVal){thisEl.val('');thisEl.removeClass('price_field_mod');}}).blur(function(){if(thisEl.val()===''||floatval(thisEl.val())<=0){thisEl.val(defaultVal);thisEl.addClass('price_field_mod');}});}}
jQuery(document).ready(function(){if(typeof(Storage)!=='undefined'&&!empty(sessionStorage.sAfterReloadRunMe)){setTimeout(function(){eval(sessionStorage.sAfterReloadRunMe);sessionStorage.sAfterReloadRunMe=null;},1);}
jQuery('textarea[maxlength]').live('keyup blur',function(){var maxlength=jQuery(this).attr('maxlength');var val=jQuery(this).val();if(val.length>maxlength)jQuery(this).val(val.slice(0,maxlength));});ToolTips=jQuery('[title]');ToolTips.each(function(i,el){el.setAttribute('tooltip',el.title);});jQuery(ToolTips).basicToolTip();var priceFields=jQuery(jQuery('body').find('input[type=text][price_field]'));priceFields.each(function(){priceFieldsFunction(this);});var pageBody=jQuery(jQuery('body')[0]);var dynamicLogin=jQuery('div#dynamic_login').dialog({autoOpen:false,title:'Потребителски вход',modal:true,resizable:false,width:'auto',draggable:true,open:function(){jQuery(jQuery('div#dynamic_login').find('input[type=text][name=user_name]')[0]).val('')
jQuery(jQuery('div#dynamic_login').find('input[type=password][name=user_pass]')[0]).val('');jQuery(jQuery('div#dynamic_login').find('span.error_messages')[0]).text('');},close:function(){pageBody.css({overflow:'auto'});}});dynamicLogin.delegate('input#user_pass[type=password].','keyup',function(oEvent){if(oEvent.keyCode!==13)return true;dynamicLogin.find('input[type=button][name=login]').click();});jQuery('.check_for_login').click(function(e){e.preventDefault();var thisEl=this;jQuery.post('ajax/base.ajax.php',{action:'checkForLogin'},function(response){if(response){eval(jQuery(thisEl).attr('run_me'));dynamicLogin.dialog('close');return true;}
pageBody.afterDynamicLogin=function(){if(jQuery(thisEl).attr('reload')==='true'){if(typeof(Storage)!=='undefined'){var sRunMe=jQuery(thisEl).attr('run_me');if(!empty(sRunMe))sessionStorage.sAfterReloadRunMe=new String(sRunMe);}
location.href=location.href;return null;}
eval(jQuery(thisEl).attr('run_me'));dynamicLogin.dialog('close');}
pageBody.css('overflow','hidden');dynamicLogin.dialog('open');var modalWindow=jQuery(dynamicLogin.parent());var windowW=jQuery(window).width();var windowH=jQuery(window).height();var modalW=modalWindow.width();var modalH=modalWindow.height();var posW=((ceil(windowW)/2)-(ceil(modalW)/2));var posH=((ceil(windowH)/2)-(ceil(modalH)/2));modalWindow.css('position','fixed');modalWindow.css('left',posW);modalWindow.css('top',posH);return false;},'json');});jQuery('div#dynamic_login input[type=button][name=login]').click(function(e){e.preventDefault();var userName=jQuery(jQuery('div#dynamic_login').find('input[type=text][name=user_name]')[0]).val();var userPass=jQuery(jQuery('div#dynamic_login').find('input[type=password][name=user_pass]')[0]).val();var errorMessages=jQuery(jQuery('div#dynamic_login').find('span.error_messages')[0]);errorMessages.text('');jQuery.post('/user_login.php',{'username':userName,'password':userPass,'action':'dynamic_login'},function(response){if(!empty(response)){errorMessages.text(response);return false;}
pageBody.afterDynamicLogin();},'json');});sendMailDialog=jQuery(jQuery('div#send_mail_dialog')[0]).dialog({autoOpen:false,title:'Изпрати имейл',modal:true,resizable:false,width:'auto',draggable:true,open:function(){var thisEl=jQuery(this);setTimeout(function(){pageBody.css({overflow:'hidden'});},1);this.sendMailToID=jQuery(thisEl.find('input[type=hidden][name=send_mail_to]')[0]);this.sendMailSource=jQuery(thisEl.find('input[type=hidden][name=send_mail_source]')[0]);this.auctionID=jQuery(thisEl.find('input[type=hidden][name=id_auction]')[0]);this.mailSender=jQuery(thisEl.find('input[type=hidden][name=mail_sender]')[0]);this.chkCopy=jQuery(thisEl.find('input[type=checkbox][name=copy_to_me]')[0])[0];this.userName=jQuery(thisEl.find('span.user_name')[0]);this.userRate=jQuery(thisEl.find('span.user_rate')[0]);this.userRateIcon=jQuery(thisEl.find('div.user_rate_icon')[0]);this.message=jQuery(thisEl.find('textarea[name=message]')[0]);this.messageEl=thisEl.find('textarea[name=message]')[0];this.buttonEl=thisEl.find('input[type=button][name=send_mail]')[0];this.statusMsg=jQuery(thisEl.find('tr.status_message')[0]);jQuery.post('ajax/base.ajax.php',{action:'getUserRateDataByID',id_user:this.sendMailToID.val()},function(response){var userName='';var userRate='';var userRateIconPos='0 18px';if(!empty(response)){userName=response.user_name;userRate=response.rate;if(!empty(response.rate_icon_pos))userRateIconPos=response.rate_icon_pos;}
var title=''+'<table border="0" class="rate">'+'<tr>'+'<td><span class="bold">Изпрати имейл до</span></td>'+'<td><span class="green user_name">'+userName+'</span></td>'+'<td><span class="green user_rate">('+userRate+')</span></td>'+'<td><div class="user_rate_icon" style="background-image: url(images/sprites/user_rate_stars.png); background-position: '+userRateIconPos+'"></div></td>'+'</tr>'+'</table>';sendMailDialog.dialog({title:title});},'json');jQuery.post('ajax/base.ajax.php',{action:'getUserRateDataByID',id_user:this.mailSender.val()},function(response){var userName='';var userRate='';var userRateIconPos='0 18px';if(!empty(response)){userName=response.user_name;userRate=response.rate;if(!empty(response.rate_icon_pos))userRateIconPos=response.rate_icon_pos;}
var senderRateTable=jQuery(sendMailDialog.find('table.sender')[0]);senderRateTable.find('span.user_name').text(userName);senderRateTable.find('span.user_rate').text('('+userRate+')');senderRateTable.find('div.user_rate_icon').css('background-image','url(images/sprites/user_rate_stars.png)');if(userRateIconPos=='0 18px'){senderRateTable.find('div.user_rate_icon').css('display','none');}else{senderRateTable.find('div.user_rate_icon').css('display','block');senderRateTable.find('div.user_rate_icon').css('background-position',userRateIconPos);}},'json');var forAuction=jQuery(thisEl.find('tr.for_auction'));var auctionID=intval(this.auctionID.val());if(!auctionID)forAuction.hide();else{jQuery.post('ajax/base.ajax.php',{action:'getAuctionTitle',id_auction:auctionID},function(title){jQuery(forAuction.find('td')).text(title);},'json');forAuction.show();}},close:function(){pageBody.css('overflow','auto');this.message.val('');this.messageEl.c_disabled(false);this.buttonEl.c_disabled(false);this.chkCopy.c_disabled(false);this.statusMsg.hide();this.sendMailToID.val('');this.sendMailSource.val('');this.auctionID.val('');}});var sendMailButton=jQuery(sendMailDialog.find('input[type=button][name=send_mail]')[0]).click(function(){var sendParams={};var mask=jQuery(sendMailDialog.find('div#mask_container')[0]);mask.show();var statusContainer=jQuery(sendMailDialog.find('tr.status_message')[0]);var statusMessage=jQuery(sendMailDialog.find('tr.status_message span')[0]);allFields=[sendMailDialog.find('textarea#message')[0],sendMailDialog.find('input[type=button][name=send_mail]')[0],sendMailDialog.find('input[type=checkbox][name=copy_to_me]')[0]];sendMailDialog.find('input, textarea').each(function(){var thisEl=jQuery(this);if(thisEl.attr('type')==='checkbox'){if(thisEl.is(':checked'))sendParams[this.name]=jQuery(this).val();}else sendParams[this.name]=jQuery(this).val();});sendParams['action']='senMailToUser';jQuery.post('ajax/base.ajax.php',sendParams,function(response){statusMessage.html(response.message);if(response.status!=true){statusMessage.removeClass('green');statusMessage.addClass('red');}else{statusMessage.removeClass('red');statusMessage.addClass('green');jQuery(allFields).each(function(){this.c_disabled(true);});}
statusContainer.show();mask.hide();},'json');});});function numbersonly(myfield,e,dec){var key;var keychar;if(window.event)
key=window.event.keyCode;else if(e)key=e.which;else return true;keychar=String.fromCharCode(key);if((key==null)||(key==0)||(key==8)||(key==9)||(key==13)||(key==27))return true;else if((("0123456789").indexOf(keychar)>-1))return true;else if(dec&&(keychar==".")){myfield.form.elements[dec].focus();return false;}else return false;}